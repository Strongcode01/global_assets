{% load static %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Dashboard{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'dashboard/css/style.css' %}">
    <style>
      /* General Layout Enhancements */
      .crypto-widgets {
        margin: 20px 0;
        display: inline;
      }

      .ticker-container {
        background: var(--card-bg);
        border-radius: 10px;
        padding: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      }

      .ticker-container iframe {
        width: 100%;
        height: 45px;
        border: none;
      }

      .market-chart, .market-ticker {
        background: var(--card-bg);
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        padding: 15px;
        margin: 40px 0;
      }

      .market-chart iframe {
        width: 100%;
        height: 400px;
        border: none;
        border-radius: 10px;
      }
      .market-ticker iframe {
        width: 100%;
        height: 30px;
        border: none;
        border-radius: 10px;
      }

      @media (min-width: 768px) {
        .crypto-widgets {
          grid-template-columns: 2fr 1fr;
        }
      }
      
      .welcome-profile {
        position: sticky;
        top: 0;                 
        z-index: 1000;          
        display: flex;          
        justify-content: flex-end;
        text-align: right;
        padding: 10px 20px;
        margin-bottom: 40px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      
    </style>
</head>
<body>
    <div class="layout">
        <aside class="sidebar">
            <div class="brand">QFS Global</div>
            <nav>
                <a href="{% url 'dashboard:dashboard' %}">üè† Dashboard</a>
                <a href="{% url 'dashboard:link_wallet' %}">üîó Link Wallet</a>
                <a href="{% url 'dashboard:transactions' %}">üí≥ Transactions</a>
                <a href="{% url 'dashboard:investments' %}">üìà Investments</a>
                <a href="{% url 'dashboard:kyc' %}">ü™™ KYC</a>
                <a href="{% url 'core:home' %}">üè† Home</a>
                <a href="{% url 'core:logout' %}">üö™ Logout</a>
            </nav>
            <button id="theme-toggle">üåì Theme - Dark / Light </button>
        </aside>

        <main class="content">
          <div class="welcome-profile">
            <div class="profile-info">
              {% if profile.kyc_verified %}
                <span class="verified">‚úî Verified</span>
                {% if profile.kyc and profile.kyc.profile_pic %}
                  <img src="{{ profile.kyc.profile_pic.url }}" alt="{{ request.user.username }}">
                {% else %}
                  <img src="{% static 'dashboard/images/default-avatar.png' %}" alt="Default Avatar">
                {% endif %}
                <h2>Welcome, {{ request.user.username }}</h2>
              {% else %}
                <span class="unverified">‚úñ Pending</span>
                {% if profile.kyc and profile.kyc.profile_pic %}
                  <img src="{{ profile.kyc.profile_pic.url }}" alt="{{ request.user.username }}">
                {% else %}
                  <img src="{% static 'dashboard/images/default-avatar.png' %}" alt="Default Avatar">
                {% endif %}
                <h4>Hi, {{ request.user.username }}</h4>
              {% endif %}
            </div>
          </div>

          <!-- LIVE CRYPTO WIDGETS START -->
            <div class="crypto-widgets">

              <!-- Live Coin Price Ticker -->
              <div class="market-ticker">
                <iframe src="https://widget.coinlib.io/widget?type=horizontal_v2&theme=light&pref_coin_id=1505&invert_hover="></iframe>
              </div>
              <!-- <h3 style="text-align: center;">Your centralized control panel for QFS Global assets.</h3> -->
            
            {% block content %}{% endblock %}


            <!-- Live Crypto Chart -->
              <div class="market-chart">
                <iframe src="https://widget.coinlib.io/widget?type=chart&theme=light&coin_id=859&pref_coin_id=1505"></iframe>
              </div>
            </div>
        </main>
    </div>

    <footer>
        &copy; 2025 QFS Global Asset - All rights reserved.
    </footer>

    <script>
      // Apply saved theme on load
      document.addEventListener("DOMContentLoaded", () => {
        const savedTheme = localStorage.getItem("theme") || "light"; // default to light
        document.documentElement.dataset.theme = savedTheme;
      });

      // Theme toggle logic
      const toggle = document.getElementById('theme-toggle');
      toggle.addEventListener('click', () => {
        const currentTheme = document.documentElement.dataset.theme;
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.documentElement.dataset.theme = newTheme;
        localStorage.setItem("theme", newTheme); // persist the choice
      });

      // Adapt widgets to theme
      function updateWidgetTheme() {
        const theme = document.documentElement.dataset.theme;
        const iframes = document.querySelectorAll('.crypto-widgets iframe');
        iframes.forEach(iframe => {
          if (theme === 'dark') {
            iframe.src = iframe.src.replace('theme=light', 'theme=dark');
          } else {
            iframe.src = iframe.src.replace('theme=dark', 'theme=light');
          }
        });
      }

      toggle.addEventListener('click', updateWidgetTheme);
    </script>

</body>
</html>
