{% load static %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Dashboard{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'dashboard/css/style.css' %}">
    <style>
/* ===============================================
       GLOBAL LOADER
    ================================================ */
    #global-page-loader {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 9999;
      align-items: center;
      justify-content: center;
      background: rgba(2, 0, 3, 0.9);
    }
    #global-page-loader.show { display: flex; }

    .loader5 {
      position: relative;
      width: 80px;
      height: 80px;
    }
    .loader5 span {
      position: absolute;
      border: 3px solid #aa90d3;
      border-radius: 50%;
      opacity: 1;
      animation: loader5-animation 1.2s cubic-bezier(0, 0.2, 0.8, 1) infinite;
    }
    .loader5 span:nth-child(2) { animation-delay: -0.5s; }

    @keyframes loader5-animation {
      0%, 4.9% { top: 36px; left: 36px; width: 0; height: 0; opacity: 0; }
      5% { opacity: 1; }
      100% { top: 0; left: 0; width: 72px; height: 72px; opacity: 0; }
    }

    /* ===============================================
       SIDEBAR & NAVIGATION
    ================================================ */
    .sidebar {
      background: var(--card-bg);
      padding: 20px;
      width: 250px;
      height: 100vh;
      border-right: 1px solid #ddd;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: fixed;
      top: 0;
      left: 0;
      transition: transform 0.3s ease-in-out;
      z-index: 999;
    }

    .sidebar nav a {
      display: block;
      color: var(--text);
      padding: 10px 0;
      text-decoration: none;
      transition: color 0.3s;
    }

    .sidebar nav a:hover {
      color: var(--accent);
    }

    .brand {
      font-size: 1.4rem;
      font-weight: bold;
      margin-bottom: 30px;
    }

    #theme-toggle {
      background: var(--accent);
      border: none;
      color: white;
      padding: 8px 10px;
      border-radius: 6px;
      cursor: pointer;
      width: 100%;
      padding-bottom: 2rem;
    }

    /* ===============================================
       LAYOUT
    ================================================ */
    .layout {
      display: flex;
    }

    .content {
      margin-left: 260px;
      padding: 20px;
      width: calc(100% - 260px);
      transition: margin-left 0.3s ease;
    }

    /* ===============================================
       PROFILE SECTION
    ================================================ */
    .profile-info {
      text-align: right;
      padding: 1rem;
    }

    .profile-avatar {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #ddd;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }

    .verified, .unverified {
      position: absolute;
      bottom: 5px;
      right: 38%;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      font-weight: bold;
      border-radius: 50%;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      color: #fff;
    }

    .verified { background: #28a745; }
    .unverified { background: #dc3545; }

    .welcome-title, .welcome-subtitle {
      margin-top: 10px;
      color: var(--text);
    }

    /* ===============================================
       CRYPTO WIDGETS
    ================================================ */
    .crypto-widgets {
      margin: 30px 0;
    }

    .market-ticker, .market-chart {
      background: var(--card-bg);
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      padding: 15px;
      margin-bottom: 40px;
    }

    .market-ticker iframe {
      width: 100%;
      height: 30px;
      border: none;
      border-radius: 10px;
    }

    .market-chart iframe {
      width: 100%;
      height: 400px;
      border: none;
      border-radius: 10px;
    }

    /* ===============================================
       MOBILE RESPONSIVE
    ================================================ */
    .hamburger {
      display: none;
      cursor: pointer;
      font-size: 1.8rem;
      background: none;
      border: none;
      color: var(--text);
      position: fixed;
      top: 15px;
      left: 20px;
      z-index: 1001;
    }

    @media (max-width: 768px) {
      .hamburger { display: block; }

      .sidebar {
        transform: translateX(-100%);
        width: 230px;
      }

      .sidebar.active {
        transform: translateX(0);
      }

      .content {
        margin-left: 0;
        width: 100%;
      }

      .menu-toggle {
        position: fixed;
        top: 15px;
        left: 15px;
        background: var(--accent);
        color: #fff;
        border: none;
        padding: 10px 12px;
        border-radius: 6px;
        font-size: 18px;
        z-index: 1000;
        cursor: pointer;
      }
    }

    /* ===============================================
       FOOTER
    ================================================ */
    footer {
      text-align: center;
      padding: 15px;
      color: #999;
      font-size: 0.9rem;
    }
    </style>
</head>
<body>
    <!-- Spinner overlay -->
    <div id="global-page-loader" aria-hidden="true">
      <div class="loader5" role="status" aria-label="Loading">
        <span></span><span></span>
      </div>
  </div>
    <div class="layout">
        <aside class="sidebar">
            <div class="brand">QFS Global</div>
            <nav>
              <button id="hamburger" class="hamburger" aria-label="Menu">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
              </button>
                <a href="{% url 'dashboard:dashboard' %}">üè†  Dashboard</a>
                <a href="{% url 'dashboard:link_wallet' %}">üîó  Link Wallet</a>
                <a href="{% url 'dashboard:transactions' %}">üí≥  Transactions</a>
                <!-- <a href="{% url 'dashboard:investments' %}">üìà Investments</a> -->
                <a href="{% url 'dashboard:kyc' %}">ü™™ KYC</a>
                <a href="{% url 'core:home' %}">üè†  Home</a>
                <a href="{% url 'core:logout' %}">üö™  Logout</a>
            </nav>
            <button id="theme-toggle">üåì Theme - Dark / Light </button>
        </aside>

        <main class="content">
          <div class="welcome-profile">
            <div class="profile-info" role="region" aria-label="User profile summary">
              
              <!-- Profile Picture -->
              {% if profile_pic_url %}
                <img src="{{ profile_pic_url }}" 
                    alt="{{ request.user.username }}'s profile picture"
                    class="profile-avatar" loading="lazy" width="110" height="110">
              {% else %}
                <img src="{% static 'dashboard/images/default-avatar.png' %}" 
                    alt="{{ profile.username }}" class="profile-avatar" loading="lazy" width="110" height="110">
              {% endif %}

              <!-- Welcome Message -->
              {% if kyc and kyc.status == "verified" %}
                <h2 class="welcome-title">
                  Welcome, {{ request.user.username|default:"User" }}
                  <small class="kyc-status-text verified"> ‚úî </small>
                </h2>
              {% elif kyc and kyc.status == "pending" %}
                <h2 class="welcome-title">
                  Hi, {{ request.user.username|default:"User" }}
                  <small class="kyc-status-text pending" style="color: orangered;">  ‚úñ  </small>
                </h2>
              {% else %}
                <h2 class="welcome-title">
                  Hi, {{ request.user.username|default:"User" }}
                  <small class="kyc-status-text unverified"> ‚úñ </small>
                </h2>
              {% endif %}

            </div>
          </div>


          <!-- LIVE CRYPTO WIDGETS START -->
          <div class="crypto-widgets" aria-live="polite">
            <!-- Live Coin Price Ticker -->
            <div class="market-ticker" role="region" aria-label="Cryptocurrency ticker">
              <iframe src="https://widget.coinlib.io/widget?type=horizontal_v2&theme=light&pref_coin_id=1505&invert_hover="
                      title="Live coin price ticker" loading="lazy" referrerpolicy="no-referrer"></iframe>
            </div>

            {% block content %}{% endblock %}

            <!-- Live Crypto Chart -->
            <div class="market-chart" role="region" aria-label="Market chart">
              <iframe src="https://widget.coinlib.io/widget?type=chart&theme=light&coin_id=859&pref_coin_id=1505"
                      title="Live market chart" loading="lazy" referrerpolicy="no-referrer"></iframe>
            </div>
          </div>
        </main>

    </div>

    <footer>
        &copy; 2025 QFS Global Asset - All rights reserved.
    </footer>

    <script>
      // Apply saved theme on load
      document.addEventListener("DOMContentLoaded", () => {
        const savedTheme = localStorage.getItem("theme") || "light"; // default to light
        document.documentElement.dataset.theme = savedTheme;
      });

      // Theme toggle logic
      const toggle = document.getElementById('theme-toggle');
      toggle.addEventListener('click', () => {
        const currentTheme = document.documentElement.dataset.theme;
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.documentElement.dataset.theme = newTheme;
        localStorage.setItem("theme", newTheme); // persist the choice
      });

      // Adapt widgets to theme
      function updateWidgetTheme() {
        const theme = document.documentElement.dataset.theme;
        const iframes = document.querySelectorAll('.crypto-widgets iframe');
        iframes.forEach(iframe => {
          if (theme === 'dark') {
            iframe.src = iframe.src.replace('theme=light', 'theme=dark');
          } else {
            iframe.src = iframe.src.replace('theme=dark', 'theme=light');
          }
        });
      }

      toggle.addEventListener('click', updateWidgetTheme);


      const hamburger = document.createElement('button');
      hamburger.classList.add('hamburger');
      hamburger.innerHTML = '‚ò∞'; // hamburger icon
      document.body.prepend(hamburger);

      const sidebar = document.querySelector('.sidebar');

      hamburger.addEventListener('click', () => {
        sidebar.classList.toggle('active');
        hamburger.textContent = sidebar.classList.contains('active') ? '‚úñ' : '‚ò∞';
      });

      // Page loader script
    (function () {
      const loader = document.getElementById('global-page-loader');
      const show = () => { loader.classList.add('show'); loader.setAttribute('aria-hidden', 'false'); };
      const hide = () => { loader.classList.remove('show'); loader.setAttribute('aria-hidden', 'true'); };

      document.addEventListener('click', e => {
        const a = e.target.closest('a');
        if (a && a.href && a.target !== '_blank' && !a.href.startsWith('#')) show();
      }, true);

      document.addEventListener('submit', () => show(), true);
      window.addEventListener('pageshow', hide);
      window.addEventListener('beforeunload', show);
    })();

    </script>

</body>
</html>  