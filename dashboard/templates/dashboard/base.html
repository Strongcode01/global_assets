{% load static %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Dashboard{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'dashboard/css/style.css' %}">
    <style>

      /*------------------------------------------------------
      Loader Overlay
    ------------------------------------------------------*/
    #global-page-loader { 
      display: none; 
      position: fixed; 
      inset: 0; 
      z-index: 9999; 
      align-items: center; 
      justify-content: center; 
      background: rgba(2, 0, 3, 0.877);
    }
    #global-page-loader.show { display: flex; }

    .loader5 {
      position: relative;
      width: 80px;
      height: 80px;
    }

    .loader5 span {
      position: absolute;
      border: 3px solid #aa90d3;
      opacity: 1;
      border-radius: 50%;
      animation: loader5-animation 1.2s cubic-bezier(0, 0.2, 0.8, 1) infinite;
    }

    .loader5 span:nth-child(2) { animation-delay: -0.5s; }

    @keyframes loader5-animation {
      0%, 4.9% { top: 36px; left: 36px; width: 0; height: 0; opacity: 0; }
      5% { opacity: 1; }
      100% { top: 0; left: 0; width: 72px; height: 72px; opacity: 0; }
    }

      /* Hamburger Button - hidden on desktop */
      .hamburger {
        display: none;
        cursor: pointer;
        font-size: 1.8rem;
        background: none;
        border: none;
        color: var(--text);
        position: fixed;
        top: 15px;
        left: 20px;
        z-index: 1001;
      }

      /* Sidebar default (desktop) */
      .sidebar {
        background: var(--card-bg);
        padding: 20px;
        width: 250px;
        height: 100vh;
        border-right: 1px solid #ddd;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        position: static;
        transition: transform 0.3s ease-in-out;
      }

      /* Mobile Styles */
      @media (max-width: 768px) {
        .hamburger {
          display: block;
        }

        .sidebar {
          position: fixed;
          top: 0;
          left: 0;
          transform: translateX(-100%);
          height: 100vh;
          width: 230px;
          z-index: 1000;
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .content {
          margin-left: 0 !important;
        }
      }

      /* General Layout Enhancements */
      .crypto-widgets {
        margin: 20px 0;
        display: inline;
      }

      .ticker-container {
        background: var(--card-bg);
        border-radius: 10px;
        padding: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      }

      .ticker-container iframe {
        width: 100%;
        height: 45px;
        border: none;
      }

      .market-chart, .market-ticker {
        background: var(--card-bg);
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        padding: 15px;
        margin: 40px 0;
      }

      .market-chart iframe {
        width: 100%;
        height: 400px;
        border: none;
        border-radius: 10px;
      }
      .market-ticker iframe {
        width: 100%;
        height: 30px;
        border: none;
        border-radius: 10px;
      }

      @media (min-width: 768px) {
        .crypto-widgets {
          grid-template-columns: 2fr 1fr;
        }
      }
      
      .welcome-profile {
        position: sticky;
        top: 0;                 
        z-index: 1000;          
        display: flex;          
        justify-content: flex-end;
        text-align: right;
        padding: 10px 20px;
        margin-bottom: 40px;
        margin-left: 70%;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      /* --- Base Sidebar Styling --- */
      .sidebar {
        background: var(--card-bg);
        padding: 20px;
        width: 250px;
        height: 95%;
        border-right: 1px solid #ddd;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        position: fixed;
        top: 0;
        left: 0;
        transition: transform 0.3s ease;
        z-index: 999;
      }

      .sidebar nav a {
        display: block;
        color: var(--text);
        padding: 10px 0;
        text-decoration: none;
        transition: color 0.3s;
      }

      .sidebar nav a:hover {
        color: var(--accent);
      }

      .brand {
        font-size: 1.4rem;
        font-weight: bold;
        margin-bottom: 30px;
      }

      #theme-toggle {
        background: var(--accent);
        border: none;
        color: white;
        padding: 8px 10px;
        border-radius: 6px;
        cursor: pointer;
        width: 100%;
      }

      /* --- Layout Adjustments --- */
      .layout {
        display: flex;
      }

      .content {
        margin-left: 260px;
        padding: 20px;
        width: calc(100% - 260px);
        transition: margin-left 0.3s ease;
      }

      /* --- Responsive Styling --- */
      @media (max-width: 768px) {
        .sidebar {
          width: 220px;
          height: 100vh;
          transform: translateX(-100%);
          position: fixed;
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .content {
          margin-left: 0;
          width: 100%;
        }
        

        /* Add a hamburger button */
        .menu-toggle {
          position: fixed;
          top: 15px;
          left: 15px;
          background: var(--accent);
          color: #fff;
          border: none;
          padding: 10px 12px;
          border-radius: 6px;
          font-size: 18px;
          z-index: 1000;
          cursor: pointer;
        }
      }


    </style>
</head>
<body>
    <!-- Spinner overlay -->
    <div id="global-page-loader" aria-hidden="true">
      <div class="loader5" role="status" aria-label="Loading">
        <span></span><span></span>
      </div>
  </div>
    <div class="layout">
        <aside class="sidebar">
            <div class="brand">QFS Global</div>
            <nav>
              <button id="hamburger" class="hamburger" aria-label="Menu">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
              </button>
                <a href="{% url 'dashboard:dashboard' %}">üè† Dashboard</a>
                <a href="{% url 'dashboard:link_wallet' %}">üîó Link Wallet</a>
                <a href="{% url 'dashboard:transactions' %}">üí≥ Transactions</a>
                <a href="{% url 'dashboard:investments' %}">üìà Investments</a>
                <a href="{% url 'dashboard:kyc' %}">ü™™ KYC</a>
                <a href="{% url 'core:home' %}">üè† Home</a>
                <a href="{% url 'core:logout' %}">üö™ Logout</a>
            </nav>
            <button id="theme-toggle">üåì Theme - Dark / Light </button>
        </aside>

        <main class="content">
          <div class="welcome-profile">
            <div class="profile-info">
              {% if profile.kyc_verified %}
                <span class="verified">‚úî Verified</span>
                {% if profile.kyc and profile.kyc.profile_pic %}
                  <img src="{{ profile.kyc.profile_pic.url }}" alt="{{ request.user.username }}">
                {% else %}
                  <img src="{% static 'dashboard/images/default-avatar.png' %}" alt="Default Avatar">
                {% endif %}
                <h2>Welcome, {{ request.user.username }}</h2>
              {% else %}
                <span class="unverified">‚úñ Pending</span>
                {% if profile.kyc and profile.kyc.profile_pic %}
                  <img src="{{ profile.kyc.profile_pic.url }}" alt="{{ request.user.username }}">
                {% else %}
                  <img src="{% static 'dashboard/images/default-avatar.png' %}" alt="Default Avatar">
                {% endif %}
                <h4>Hi, {{ request.user.username }}</h4>
              {% endif %}
            </div>
          </div>

          <!-- LIVE CRYPTO WIDGETS START -->
            <div class="crypto-widgets">

              <!-- Live Coin Price Ticker -->
              <div class="market-ticker">
                <iframe src="https://widget.coinlib.io/widget?type=horizontal_v2&theme=light&pref_coin_id=1505&invert_hover="></iframe>
              </div>
              <!-- <h3 style="text-align: center;">Your centralized control panel for QFS Global assets.</h3> -->
            
            {% block content %}{% endblock %}


            <!-- Live Crypto Chart -->
              <div class="market-chart">
                <iframe src="https://widget.coinlib.io/widget?type=chart&theme=light&coin_id=859&pref_coin_id=1505"></iframe>
              </div>
            </div>
        </main>
    </div>

    <footer>
        &copy; 2025 QFS Global Asset - All rights reserved.
    </footer>

    <script>
      // Apply saved theme on load
      document.addEventListener("DOMContentLoaded", () => {
        const savedTheme = localStorage.getItem("theme") || "light"; // default to light
        document.documentElement.dataset.theme = savedTheme;
      });

      // Theme toggle logic
      const toggle = document.getElementById('theme-toggle');
      toggle.addEventListener('click', () => {
        const currentTheme = document.documentElement.dataset.theme;
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.documentElement.dataset.theme = newTheme;
        localStorage.setItem("theme", newTheme); // persist the choice
      });

      // Adapt widgets to theme
      function updateWidgetTheme() {
        const theme = document.documentElement.dataset.theme;
        const iframes = document.querySelectorAll('.crypto-widgets iframe');
        iframes.forEach(iframe => {
          if (theme === 'dark') {
            iframe.src = iframe.src.replace('theme=light', 'theme=dark');
          } else {
            iframe.src = iframe.src.replace('theme=dark', 'theme=light');
          }
        });
      }

      toggle.addEventListener('click', updateWidgetTheme);


      const hamburger = document.createElement('button');
      hamburger.classList.add('hamburger');
      hamburger.innerHTML = '‚ò∞'; // hamburger icon
      document.body.prepend(hamburger);

      const sidebar = document.querySelector('.sidebar');

      hamburger.addEventListener('click', () => {
        sidebar.classList.toggle('active');
        hamburger.textContent = sidebar.classList.contains('active') ? '‚úñ' : '‚ò∞';
      });

      // Page loader script
    (function () {
      const loader = document.getElementById('global-page-loader');
      const show = () => { loader.classList.add('show'); loader.setAttribute('aria-hidden', 'false'); };
      const hide = () => { loader.classList.remove('show'); loader.setAttribute('aria-hidden', 'true'); };

      document.addEventListener('click', e => {
        const a = e.target.closest('a');
        if (a && a.href && a.target !== '_blank' && !a.href.startsWith('#')) show();
      }, true);

      document.addEventListener('submit', () => show(), true);
      window.addEventListener('pageshow', hide);
      window.addEventListener('beforeunload', show);
    })();

    </script>

</body>
</html>  